<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Presença</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Estilos para os botões de ação e modo edição */
        .btn-edit {
            background-color: #ffc107;
            color: black;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
        }

        .btn-del {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }

        .modo-edit {
            background-color: #28a745 !important;
        }

        #btnCancelar {
            background-color: #6c757d;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
        }

        /* Ajuste para os novos inputs de TA */
        .add-box input {
            padding: 8px;
            margin: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>

    <label for="dataSelecionada">Selecionar data:</label>
    <input type="date" id="dataSelecionada" onchange="trocarData()">

    <div class="container">
        <h1>Attendance List</h1>

        <div id="dashboard">
            <div>TOTAL UF: <span id="totalUF">0</span></div>
            <div>TOTAL GERAL: <span id="totalSTATUS">0</span></div>
        </div>

        <div class="add-box">
            <select id="uf">
                <option selected disabled>Selecionar UF</option>
                <option value="RJ">RJ</option>
                <option value="ES">ES</option>
            </select>

            <select id="empresa">
                <option selected disabled>Selecionar Empresa</option>
                <option value="TLP SERVIÇOS">TLP SERVIÇOS</option>
                <option value="SUB - LUZ TELECOM">SUB - LUZ TELECOM</option>
                <option value="SUB - BRZ SYS">SUB - BRZ SYS</option>
            </select>

            <select id="microArea">
                <option selected disabled>Selecionar Micro Área</option>
                <optgroup label="Cores">
                    <option value="AZUL">AZUL</option>
                    <option value="VERMELHA">VERMELHA</option>
                    <option value="AMARELA">AMARELA</option>
                    <option value="VERDE">VERDE</option>
                </optgroup>
                <optgroup label="Cidades">
                    <option value="CACHOEIRO">CACHOEIRO</option>
                    <option value="ICONHA">ICONHA</option>
                    <option value="GUARAPARI">GUARAPARI</option>
                    <option value="SERRA">SERRA</option>
                    <option value="VILA VELHA">VILA VELHA</option>
                    <option value="CARIACICA">CARIACICA</option>
                    <option value="SÃO MATEUS">SÃO MATEUS</option>
                    <option value="LINHARES">LINHARES</option>
                    <option value="COLATINA">COLATINA</option>
                    <option value="VIANA">VIANA</option>
                </optgroup>
            </select>

            <select id="colaborador">
                <option selected disabled>Selecione o Técnico</option>
                <option>AUGUSTO ALMEIDA NETO</option>
                <option>PEDRO IVO DA SILVA DIAS</option>
                <option>RAYAN SILVEIRA SCHAIDER</option>
                <option>WILLIAN LOPES PACHECO</option>
                <option>RONEY MELO SANTOS</option>
                <option>MARCO ANTONIO PETERLE TAVORA</option>
                <option>JONATAS SANTOS DOS ANJOS</option>
                <option>JOEL FERREIRA PERREIRA</option>
                <option>PATRICK HENRIQUE ALVES DE OLIV</option>
                <option>ABRAÃO SANTOS DOS ANJOS</option>
                <option>JOAIS SANTOS DE OLIVEIRA</option>
                <option>DAVID COSTA MIRANDA</option>
                <option>GUSTAVO LEITE</option>
                <option>MARCELO PEREIRA DOS SANTOS</option>
                <option>GUILHERME SOBREIRA MACHADO</option>
                <option>RAFAEL GUASTI MARTINS</option>
                <option>GABRIEL RODRIGUES E SOUZA</option>
                <option>DIOSE ALENCAR DE SOUZA</option>
                <option>BRENO NICOLAU VALASCO DA SILVA</option>
                <option>LUCAS LUIZ ALMEIDA DA VITORIA</option>
                <option>IGOR MAGNO MARTINS LEITE</option>
                <option>JOSÉ THIAGO BRITO</option>
                <option>WARLEY CARVALHO BERNADES</option>
                <option>ARTHUR SCHULTZ DOS SANTOS</option>
                <option>DOUGLAS NUNES DA COSTA</option>
                <option>JEFERSON FELIX DE JESUS</option>
                <option>KAIQUE DE MELO DE SOUZA</option>
                <option>PABLO DOS SANTOS</option>
                <option>ANDRE DOS SANTOS FUKS</option>
                <option>EDER CELIO PEREIRA</option>
                <option>DEILSON DOS SANTOS SOUZA</option>
                <option>JEAN CAMPOS DA SILVA</option>
                <option>WETHYLLEY DO CARMO NETO</option>
                <option>FABIO DUARTE</option>
                <option>WDSON NASCIMENTO DO CARMO</option>
                <option>VALDINERES DOS SANTOS</option>
                <option>VALDECI DOS REIS ANTUNES</option>
                <option>CAIO JORGE PERREIRA HONORIO</option>
                <option>UALAS FERNANDES FERREIRA</option>
                <option>EMANUEL MARTINS DE MORAES</option>
                <option>VINICIUS BARCELOS</option>
                <option>FRANCISCO FAGNER ALENCAR COSTA</option>
                <option>MICAIAS GARCIA</option>
                <option>LUCAS SANTOS DE ALMEIDA</option>
                <option>PEDRO HENRIQUE</option>
                <option>CARLOS EDUARDO MENDONÇA</option>
                <option>IGOR ALVES DE OLIVEIRA</option>
                <option>THAYRAN DE OLIVEIRA DIAS DE SOUZA</option>
                <option>EMANUEL FREITAS OTT</option>
                <option>LORRAN PEREIRA DA SILVA</option>
                <option>ROGERIO GOMES DA SILVA</option>
                <option>BRENO OLIVEIRA DA SILVA VILELA</option>
                <option>MARCELO LUIZ LEITE</option>
                <option>WALLACE FERREIRA</option>
                <option>LUCAS DA SILVA NUNES</option>
                <option>KARTLEY RODRIGUES DA SILVA</option>
                <option>GABRIEL EMANUEL DOS SANTOS TORRES</option>
                <option>LEONARDO FERREIRA</option>
                <option>GABRIEL RODRIGUES DA SILVA</option>
                <option>THIAGO PINTO EUGENIO</option>
                <option>FABIANO DE SANTANA ANDRADE</option>
                <option>GABRIEL DA SILVA COSTA</option>
                <option>HEMERSON MARCULINO</option>
                <option>LEANDRO MACEDO DO COUTO</option>
                <option>EDSON VANDER PAIXAO</option>
                <option>JONATHAN SANTOS DA SILVA</option>
                <option>ALEXSSANDRO PEDRO ARAUJO DE FREITAS</option>
                <option>MAX WILLIANFURTADO DE JESUS</option>
                <option>MOISES GOMES DA SILVA FILHO</option>
                <option>RODRIGO BANNY DA SILVA</option>
                <option>ALAN PETRILHO HONORIO</option>
                <option>MAX EMILIANO INACIO DA ROCHA</option>
                <option>IAGO DAVI D AVILA DAMAZIO</option>
                <option>RODOLPHO JOSE TAVARES</option>
                <option>VAUSLEY DA SILVA COUTINHO</option>
            </select>

            <select id="supervisorTLP">
                <option disabled selected>Selecione o Supervisor TLP</option>
                <option value="HAROLDO">HAROLDO</option>
                <option value="ADRIANO">ADRIANO</option>
                <option value="ROMULO">ROMULO</option>
                <option value="LUCIANO INACIO DA SILVA">LUCIANO INACIO DA SILVA</option>
                <option value="RAFAEL FAGNER SANTOS">RAFAEL FAGNER SANTOS</option>
                <option value="WELLINGTON MORENO">WELLINGTON MORENO</option>
                <option value="LEANDRO MARTINS ADDUB">LEANDRO MARTINS ADDUB</option>
                <option value="CLOVIS BATISTA TORRES JUNIOR">CLOVIS BATISTA TORRES JUNIOR</option>
                <option value="RICARDO LUIZ SANTA ROZA">RICARDO LUIZ SANTA ROZA</option>
                <option value="DIEGO CARDOSO">DIEGO CARDOSO</option>
                <option value="RODRIGO CUNHA DE LIMA">RODRIGO CUNHA DE LIMA</option>
                <option value="RENAN">RENAN ALVARINTO</option>
                <option value="LIVIO">LIVIO MOREIRA</option>
                <option value="PABLO">PABLO BATISTA</option>
                <option value="BRUNO">BRUNO ALCANTARA</option>
                <option value="ITALO">ITALO COELHO</option>
            </select>

            <select id="coordTLP">
                <option disabled selected>Selecione o Coordenador TLP</option>
                <option value="MARCELO ROCHA BATISTA">MARCELO ROCHA BATISTA</option>
                <option value="LUCAS PERES">LUCAS PERES</option>
                <option value="THIAGO JACOB">THIAGO JACOB</option>
                <option value="Outro Coordenador">Outro Coordenador</option>
            </select>

            <select id="status">
                <option disabled selected>Condição</option>
                <option value="PRESENTE">PRESENTE</option>
                <option value="PRESENTE - CONJUNTA">PRESENTE - CONJUNTA</option>
                <option value="PRESENTE - FORMAÇÃO">PRESENTE - FORMAÇÃO</option>
                <option value="PRESENTE - PREVENTIVA">PRESENTE - PREVENTIVA</option>
                <option value="INTERJORNADA (10H)">INTERJORNADA (10H)</option>
                <option value="INTERMEDIÁRIO (13H)">INTERMEDIÁRIO (13H)</option>
                <option value="INTERJORNADA (13H)">INTERJORNADA (13H)</option>
                <option value="INTERJORNADA (16H)">INTERJORNADA (16H)</option>
                <option value="INTERJORNADA (SEM RETORNO)">INTERJORNADA (SEM RETORNO)</option>
                <option value="NOTURNO">NOTURNO</option>
                <option value="INSS">INSS</option>
                <option value="ATESTADO">ATESTADO</option>
                <option value="FÉRIAS">FÉRIAS</option>
                <option value="FALTA">FALTA</option>
                <option value="FOLGA">FOLGA</option>
            </select>

            <input type="text" id="taPrimaria" placeholder="TA PRIMARIA">
            <input type="text" id="taSecundaria" placeholder="TA SECUNDARIA">

            <button id="btnAdicionar" onclick="adicionar()">Adicionar</button>
            <button id="btnCancelar" style="display:none;" onclick="cancelarEdicao()">Cancelar</button>
        </div>

        <button onclick="loginAdmin()" id="btnLogin">Entrar como Admin</button>

        <table border="1">
            <thead>
                <tr>
                    <th>UF</th>
                    <th>Empresa</th>
                    <th>Micro Área</th>
                    <th>Colaborador</th>
                    <th>Supervisor TLP</th>
                    <th>Coordenador TLP</th>
                    <th>Status</th>
                    <th>TA PRIMARIA</th>
                    <th>TA SECUNDARIA</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="lista"></tbody>
        </table>

        <br>
        <button onclick="exportarExcel()">Exportar Excel</button>
    </div>

    <script>
        let isAdmin = false;
        let indexEditando = null;
        let dataAtual = new Date().toISOString().split("T")[0];
        document.getElementById("dataSelecionada").value = dataAtual;

        let lista = carregarLista(dataAtual);

        function carregarLista(data) {
            return JSON.parse(localStorage.getItem("presenca_" + data)) || [];
        }

        function salvar(data) {
            localStorage.setItem("presenca_" + data, JSON.stringify(lista));
        }

        function loginAdmin() {
            const senha = prompt("Digite a senha de administrador:");
            if (senha === "1234") {
                isAdmin = true;
                alert("Login de administrador realizado!");
                render();
            } else {
                alert("Senha incorreta!");
            }
        }

        function trocarData() {
            dataAtual = document.getElementById("dataSelecionada").value;
            lista = carregarLista(dataAtual);
            cancelarEdicao();
            render();
        }

        function render() {
            const tbody = document.getElementById("lista");
            tbody.innerHTML = "";

            lista.forEach((p, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td>${p.uf}</td>
                        <td>${p.empresa || "—"}</td>
                        <td>${p.microArea}</td>
                        <td>${p.recurso}</td>
                        <td>${p.supervisorTLP}</td>
                        <td>${p.coordTLP}</td>
                        <td>${p.status}</td>
                        <td>${p.taPrimaria || "—"}</td>
                        <td>${p.taSecundaria || "—"}</td>
                        <td>
                            ${isAdmin ?
                        `<button class="btn-edit" onclick="prepararEdicao(${index})">Editar</button>
                                 <button class="btn-del" onclick="excluir(${index})">X</button>`
                        : `—`}
                        </td>
                    </tr>
                `;
            });
            atualizarDashboard();
        }

        function excluir(index) {
            if (confirm("Tem certeza que deseja excluir?")) {
                lista.splice(index, 1);
                salvar(dataAtual);
                render();
            }
        }

        function prepararEdicao(index) {
            indexEditando = index;
            const p = lista[index];

            document.getElementById("uf").value = p.uf;
            document.getElementById("empresa").value = p.empresa;
            document.getElementById("microArea").value = p.microArea;
            document.getElementById("colaborador").value = p.recurso;
            document.getElementById("supervisorTLP").value = p.supervisorTLP;
            document.getElementById("coordTLP").value = p.coordTLP;
            document.getElementById("status").value = p.status;
            document.getElementById("taPrimaria").value = p.taPrimaria || "";
            document.getElementById("taSecundaria").value = p.taSecundaria || "";

            const btn = document.getElementById("btnAdicionar");
            btn.innerText = "Salvar Alterações";
            btn.classList.add("modo-edit");
            document.getElementById("btnCancelar").style.display = "inline-block";

            window.scrollTo(0, 0);
        }

        function cancelarEdicao() {
            indexEditando = null;
            const btn = document.getElementById("btnAdicionar");
            btn.innerText = "Adicionar";
            btn.classList.remove("modo-edit");
            document.getElementById("btnCancelar").style.display = "none";

            document.querySelectorAll(".add-box select").forEach(s => s.selectedIndex = 0);
            document.getElementById("taPrimaria").value = "";
            document.getElementById("taSecundaria").value = "";
        }

        function adicionar() {
            const uf = document.getElementById("uf").value;
            const empresa = document.getElementById("empresa").value;
            const microArea = document.getElementById("microArea").value;
            const recurso = document.getElementById("colaborador").value;
            const supervisorTLP = document.getElementById("supervisorTLP").value;
            const coordTLP = document.getElementById("coordTLP").value;
            const status = document.getElementById("status").value;
            const taPrimaria = document.getElementById("taPrimaria").value;
            const taSecundaria = document.getElementById("taSecundaria").value;

            if (uf === "Selecionar UF" || empresa === "Selecionar Empresa" || !microArea ||
                recurso === "Selecione o Técnico" || !supervisorTLP || !coordTLP || !status) {
                return alert("Por favor, preencha todos os campos obrigatórios!");
            }

            const novoItem = { uf, empresa, microArea, recurso, supervisorTLP, coordTLP, status, taPrimaria, taSecundaria };

            if (indexEditando !== null) {
                lista[indexEditando] = novoItem;
                indexEditando = null;
                alert("Alterado com sucesso!");
            } else {
                lista.push(novoItem);
            }

            salvar(dataAtual);
            cancelarEdicao();
            render();
        }

        function atualizarDashboard() {
            document.getElementById("totalUF").textContent = lista.length;
            document.getElementById("totalSTATUS").textContent = lista.length;
        }

        function exportarExcel() {
            var tabela = document.querySelector("table").outerHTML;
            var nomeArquivo = `lista_presenca_${dataAtual}.xls`;
            var a = document.createElement('a');
            a.href = 'data:application/vnd.ms-excel,' + encodeURIComponent(tabela);
            a.download = nomeArquivo;
            a.click();
        }

        render();
    </script>
</body>

</html>
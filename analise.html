<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Dashboard - Presen√ßa</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #348ddb;
            --success: #27ae60;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --gold: #f1c40f;
        }

        /* Moldura personalizada solicitada */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f4f7f6;
            margin: 0;
            padding: 20px;
            border: 12px solid var(--primary);
            /* Borda externa */
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            max-width: 1400px;
            margin: auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px solid var(--accent);
            padding-bottom: 10px;
        }

        /* √Årea de Filtros Superiores */
        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 11px;
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
        }

        select,
        input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        /* Dashboard de Resumo */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .db-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-top: 5px solid var(--accent);
        }

        .db-card h3 {
            margin: 0;
            font-size: 12px;
            color: var(--secondary);
        }

        .db-card .value {
            font-size: 26px;
            font-weight: bold;
            display: block;
            margin-top: 10px;
        }

        /* Tabela de Resultados */
        .table-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }

        th {
            background: var(--primary);
            color: white;
            padding: 15px;
            text-align: left;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            color: white;
            font-weight: bold;
            font-size: 10px;
        }

        .btn-voltar {
            background: var(--secondary);
            color: white;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 20px;
            font-size: 13px;
        }
    </style>
</head>

<body>

    <div class="container">
        <a href="index.html" class="btn-voltar">‚¨Ö Voltar para Lan√ßamentos</a>

        <header>
            <h1>üìä An√°lise de Presen√ßa por Hierarquia</h1>
        </header>

        <div class="filter-section">
            <div class="filter-group">
                <label>1. Data da An√°lise</label>
                <input type="date" id="filtroData" onchange="filtrarTudo()">
            </div>
            <div class="filter-group">
                <label>2. UF</label>
                <select id="filtroUF" onchange="carregarGerentes()">
                    <option value="">Todas</option>
                    <option value="RJ">RJ - Rio de Janeiro</option>
                    <option value="ES">ES - Esp√≠rito Santo</option>
                </select>
            </div>
            <div class="filter-group">
                <label>3. Gerente TLP</label>
                <select id="filtroGerente" onchange="carregarCoordenadores()">
                    <option value="">Selecione a UF</option>
                </select>
            </div>
            <div class="filter-group">
                <label>4. Coordenador</label>
                <select id="filtroCoordenador" onchange="carregarSupervisores()">
                    <option value="">Selecione o Gerente</option>
                </select>
            </div>
            <div class="filter-group">
                <label>5. Supervisor</label>
                <select id="filtroSupervisor" onchange="filtrarTudo()">
                    <option value="">Selecione o Coordenador</option>
                </select>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="db-card">
                <h3>Total Escalado</h3>
                <span class="value" id="resumo-total">0</span>
            </div>
            <div class="db-card" style="border-top-color: var(--success)">
                <h3>Presentes</h3>
                <span class="value" id="resumo-presentes" style="color: var(--success)">0</span>
            </div>
            <div class="db-card" style="border-top-color: var(--danger)">
                <h3>Aus√™ncias/Atestados</h3>
                <span class="value" id="resumo-ausentes" style="color: var(--danger)">0</span>
            </div>
            <div class="db-card" style="border-top-color: var(--gold)">
                <h3>% de Presen√ßa</h3>
                <span class="value" id="resumo-perc">0%</span>
            </div>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Colaborador</th>
                        <th>UF</th>
                        <th>Gerente</th>
                        <th>Coordenador</th>
                        <th>Supervisor</th>
                        <th>Micro √Årea</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="corpoTabela"></tbody>
            </table>
        </div>
    </div>

    <script>
        // MESMA BASE DE DADOS DA SUA INDEX.HTML
        const baseDados = {
            "ALAN PETRILHO HONORIO": { uf: "RJ", super: "LEANDRO MARTINS ABBUD", coord: "MARCELO ROCHA BATISTA", empresa: "TLP SERVI√áOS", micro: "VERMELHA - INTERIOR" },
            "ALESSANDER SANTOS DOMINGOS": { uf: "RJ", super: "RODRIGO CUNHA DE LIMA", coord: "MARCELO ROCHA BATISTA", empresa: "TLP SERVI√áOS", micro: "AZUL - OESTE" },
            "ANDRE LUIZ SOARES DA COSTA": { uf: "RJ", super: "WELLINGTON MORENO", coord: "MARCELO ROCHA BATISTA", empresa: "TLP SERVI√áOS", micro: "AZUL - NORTE" },
            "AUGUSTO ALMEIDA NETO": { uf: "ES", super: "RENAN ALVARINTO", coord: "LUCAS PERES", empresa: "TLP SERVI√áOS", micro: "CACHOEIRO" },
            "PEDRO IVO DA SILVA DIAS": { uf: "ES", super: "LIVIO MOREIRA", coord: "LUCAS PERES", empresa: "TLP SERVI√áOS", micro: "CACHOEIRO" },
            "RAYAN SILVEIRA SCHAIDER": { uf: "ES", super: "PABLO BATISTA", coord: "LUCAS PERES", empresa: "TLP SERVI√áOS", micro: "ICONHA" },
            // ... (A l√≥gica buscar√° os nomes aqui)
        };

        const getGerente = (uf) => uf === "RJ" ? "FABRICIO LEAL" : "PAULO RADAELLI";

        window.onload = () => {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('filtroData').value = hoje;
            filtrarTudo();
        };

        function carregarGerentes() {
            const uf = document.getElementById('filtroUF').value;
            const sel = document.getElementById('filtroGerente');
            sel.innerHTML = '<option value="">Todos</option>';
            if (uf) sel.innerHTML += `<option value="${getGerente(uf)}">${getGerente(uf)}</option>`;
            carregarCoordenadores();
        }

        function carregarCoordenadores() {
            const uf = document.getElementById('filtroUF').value;
            const sel = document.getElementById('filtroCoordenador');
            sel.innerHTML = '<option value="">Todos</option>';

            const coords = [...new Set(Object.values(baseDados)
                .filter(d => (d.uf === uf || uf === ""))
                .map(d => d.coord))].sort();

            coords.forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
            carregarSupervisores();
        }

        function carregarSupervisores() {
            const coord = document.getElementById('filtroCoordenador').value;
            const sel = document.getElementById('filtroSupervisor');
            sel.innerHTML = '<option value="">Todos</option>';

            const supers = [...new Set(Object.values(baseDados)
                .filter(d => (d.coord === coord || coord === ""))
                .map(d => d.super))].sort();

            supers.forEach(s => sel.innerHTML += `<option value="${s}">${s}</option>`);
            filtrarTudo();
        }

        function filtrarTudo() {
            const data = document.getElementById('filtroData').value;
            const uf = document.getElementById('filtroUF').value;
            const gerente = document.getElementById('filtroGerente').value;
            const coord = document.getElementById('filtroCoordenador').value;
            const supervisor = document.getElementById('filtroSupervisor').value;

            // Puxa os dados salvos pela index.html no LocalStorage
            let registros = JSON.parse(localStorage.getItem('registros_presenca')) || [];

            const filtrados = registros.filter(r => {
                const info = baseDados[r.colaborador] || {};
                const gerenteColab = getGerente(info.uf);

                return (r.data === data) &&
                    (info.uf === uf || uf === "") &&
                    (gerenteColab === gerente || gerente === "") &&
                    (info.coord === coord || coord === "") &&
                    (info.super === supervisor || supervisor === "");
            });

            atualizarInterface(filtrados);
        }

        function atualizarInterface(dados) {
            const total = dados.length;
            const presentes = dados.filter(d => d.status.startsWith("PRESENTE")).length;
            const ausentes = total - presentes;
            const perc = total > 0 ? Math.round((presentes / total) * 100) : 0;

            document.getElementById('resumo-total').innerText = total;
            document.getElementById('resumo-presentes').innerText = presentes;
            document.getElementById('resumo-ausentes').innerText = ausentes;
            document.getElementById('resumo-perc').innerText = perc + "%";

            const tbody = document.getElementById('corpoTabela');
            tbody.innerHTML = "";

            dados.forEach(r => {
                const info = baseDados[r.colaborador] || {};
                const cor = r.status.startsWith("PRESENTE") ? "var(--success)" : "var(--danger)";

                tbody.innerHTML += `
                    <tr>
                        <td><b>${r.colaborador}</b></td>
                        <td>${info.uf || '-'}</td>
                        <td>${getGerente(info.uf)}</td>
                        <td>${info.coord || '-'}</td>
                        <td>${info.super || '-'}</td>
                        <td>${info.micro || '-'}</td>
                        <td><span class="status-badge" style="background:${cor}">${r.status}</span></td>
                    </tr>
                `;
            });
        }
    </script>
</body>

</html>